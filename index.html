<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>LUCKY 7</title>

  <meta name="theme-color" content="#17173A" />
  <link rel="apple-touch-icon" href="icon-512.png">

  <style>
    :root { --bg:#17173A; --fg:#ffffff; --card:#ffffff; --accent:#ffffff; }

    /* Layout */
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--bg); color: var(--fg);
      font-family: Arial, sans-serif;
      -webkit-text-size-adjust: none;
      touch-action: manipulation;
      overscroll-behavior: none;
      overflow: hidden; /* only .app may scroll */
    }
    body.modal-open { overflow: hidden; height: 100%; }

    .app {
      height: 100dvh;
      display: flex; flex-direction: column;
      overflow: auto; /* single scrollbar if needed */
      -webkit-overflow-scrolling: touch;
      padding:
        env(safe-area-inset-top)
        env(safe-area-inset-right)
        env(safe-area-inset-bottom)
        env(safe-area-inset-left);
    }
    .app-inner {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      padding: 20px; box-sizing: border-box; text-align: center;
    }

    .logo { width: clamp(160px, 30vw, 360px); height: auto; margin: 0 auto 18px; }

    .cards {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin: 20px 0;
    }

    .card-container { perspective: 1000px; }

    .card-inner {
      width: clamp(90px, 12vw, 120px);
      height: clamp(150px, 21vw, 200px);
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
      cursor: pointer;
    }
    .card.flipped .card-inner { transform: rotateY(180deg); cursor: default; }

    .card-face {
      position: absolute; width: 100%; height: 100%;
      border-radius: 12px; backface-visibility: hidden;
      display: flex; align-items: center; justify-content: center;
      font-size: clamp(28px, 4vw, 48px); font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .card-front { background: royalblue; border: 3px solid #fff; box-sizing: border-box; }
    .card-back  { background: var(--card); color: #000; border: 3px solid #fff; box-sizing: border-box; transform: rotateY(180deg); position: relative; }

    .card-back.show-now { opacity: 1 !important; transition-delay: 0s !important; }

    .position-label { font-size:clamp(14px,2vw,18px); margin-top:6px; color:var(--fg); }

    .button-row { display:flex; justify-content:center; gap:16px; margin-top:15px; }
    #howToPlayButton {
      padding:8px 20px; min-width:120px; font-size:16px; font-weight:bold;
      border-radius:6px; background:var(--bg); color:var(--fg);
      border:2px solid var(--accent); cursor:pointer;
    }
    #howToPlayButton:hover{ background:#1e1e45; }

    .scoreboard{ display:flex; justify-content:center; gap:20px; margin-top:15px; }
    .scorebox{ background:var(--card); color:#000; padding:10px 20px; border-radius:8px; font-size:18px; font-weight:bold; min-width:100px; }

    .win-overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:10001; pointer-events:none; }
    .win-overlay .text{ font-size:clamp(72px,16vw,220px); font-weight:900; color:#FFD700;
      text-shadow:-4px -4px 0 #000,4px -4px 0 #000,-4px 4px 0 #000,4px 4px 0 #000,0 -5px 0 #000,0 5px 0 #000,-5px 0 0 #000,5px 0 0 #000;
      animation:winTextFlash .25s ease-in-out infinite alternate; }
    @keyframes winTextFlash{ 0%{transform:scale(1)} 100%{transform:scale(1.12)} }
    .win-overlay.show{ display:flex; }

    .copyright{ font-size:1em; margin-top:10px; opacity:.8; }

    canvas.confetti { position:fixed; inset:0; pointer-events:none; z-index:10000; }

    .fs-toggle{ position:fixed; top:10px; right:10px; width:34px; height:34px; line-height:30px; text-align:center; font-size:20px; font-weight:900; color:#fff; background:rgba(0,0,0,.35); border:2px solid #fff; border-radius:8px; cursor:pointer; z-index:10002; backdrop-filter:blur(2px); }
    .fs-toggle:active{ transform:scale(.96); }

    #promoModal{
      display:none; position:fixed; z-index:10050; inset:0;
      background:rgba(0,0,0,.75); backdrop-filter:blur(2px);
      overflow:auto;
    }
    #promoContent{
      background:#1D1D3F; color:#fff;
      margin:32px auto 0;
      padding:20px 22px;
      border-radius:12px;
      max-width:420px;
      width:calc(100% - 40px);
      text-align:left;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      display:flex;
      flex-direction:column;
      position:relative;
    }
    #promoContent .ad-hero{
      width:100%;
      height:auto;
      display:block;
      border-radius:8px;
      margin-bottom:12px;
      object-fit:cover;
    }
    .promo-body{ margin-bottom:10px; }
    .promo-actions{ display:flex; gap:10px; justify-content:center; margin-top:10px; }
    .promo-btn{ flex:1; text-align:center; padding:6px 12px; font-size:14px; font-weight:700; border-radius:6px; cursor:pointer; border:none; }
    .promo-btn.learn{ background:#FFD700; color:#000; text-decoration:none; }
    .promo-btn.close{ background:#fff; color:#000; }

    @media (max-width: 640px), (pointer: coarse) {
      #promoModal { padding:0; }
      #promoContent{
        position:fixed; inset:0;
        margin:0; padding:0;
        width:100vw; max-width:none;
        height:100dvh; min-height:100vh;
        border-radius:0;
        box-shadow:none;
        overflow:hidden;
      }
      #promoContent .ad-hero{
        position:absolute; inset:0;
        width:100%; height:100%;
        margin:0; border-radius:0;
        object-fit:cover;
      }
      .promo-body{ display:none; }
      .promo-actions{
        position:absolute;
        left:0; right:0; bottom:0;
        margin:0;
        padding:16px 16px calc(env(safe-area-inset-bottom) + 16px);
        background: linear-gradient(to top, rgba(0,0,0,.68), rgba(0,0,0,0));
        box-shadow:none;
      }
    }
    @media (max-height: 640px) { #promoContent { margin:0; } }

    #howToPlayModal{ display:none; position:fixed; z-index:10060; inset:0; background:rgba(0,0,0,.75); backdrop-filter:blur(2px); display:flex; align-items:center; justify-content:center; padding:16px; }
    #howToPlayContent{ background:#1D1D3F; color:#fff; padding:20px 22px; border-radius:12px; max-width:420px; width:calc(100% - 40px); text-align:left; box-shadow:0 10px 30px rgba(0,0,0,.35); margin:0; max-height:90vh; overflow:auto; }
    .howto-actions{ text-align:center; margin-top:14px; }
    .howto-actions button{ padding:10px 24px; background:#fff; color:#000; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }

    @keyframes bustBackgroundFlash {
      0%{ background:rgba(255,0,0,.25) }
      50%{ background:rgba(255,0,0,.80) }
      100%{ background:rgba(255,0,0,.25) }
    }
    .card.bustFlash .card-back {
      animation: bustBackgroundFlash 0.85s infinite;
      color:#fff;
      opacity: 1 !important;
      transition-delay: 0s !important;
    }
    @keyframes bustPulseCard {
      0% { transform: scale(1); }
      50%{ transform: scale(1.06); }
      100%{ transform: scale(1); }
    }
    .card.pulse { animation: bustPulseCard 1s ease-in-out infinite; }
    .bust-label { position:absolute; left:6px; right:6px; text-align:center; font-weight:900; color:#fff; letter-spacing:.08em; text-shadow:0 2px 4px rgba(0,0,0,.6); pointer-events:none; font-size:clamp(16px,2.5vw,22px); }
    .bust-label.top{ top:6px } .bust-label.bottom{ bottom:6px }

    /* === Center promo card on DESKTOP === */
    #promoModal{
      display: flex !important;
      justify-content: center !important;
      align-items: flex-start !important;
      padding: 32px 16px 24px !important;
    }
    #promoContent{
      margin: 0 !important;
      max-width: 420px;
      width: calc(100% - 40px);
    }
    @media (max-width: 640px), (pointer: coarse){
      #promoModal{ 
        padding: 0 !important; 
        display: block !important;
      }
      #promoContent{
        position: fixed !important;
        inset: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        width: 100vw !important;
        max-width: none !important;
        height: 100dvh !important;
        min-height: 100vh !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        overflow: hidden !important;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="app-inner">
      <img class="logo" src="logo.png?v=3" alt="Lucky 7"/>
      <div class="cards" id="cardContainer"></div>

      <div class="button-row">
        <button id="howToPlayButton" onclick="showHowToPlay()">How to Play</button>
      </div>

      <div class="scoreboard">
        <div class="scorebox">Won: <span id="winCount">0</span></div>
        <div class="scorebox">Lost: <span id="loseCount">0</span></div>
      </div>

      <div class="copyright">© Kev Shirreffs 2025</div>
    </div>
  </div>

  <button id="fsToggle" class="fs-toggle" aria-label="Enter fullscreen" title="Enter fullscreen" hidden>⛶</button>
  <div id="winOverlay" class="win-overlay"><div class="text">YOU WIN!</div></div>

  <div id="promoModal" aria-modal="true" role="dialog">
    <div id="promoContent">
      <a href="https://www.oasisinet.com/" target="_blank" rel="noopener">
        <img class="ad-hero" src="oasis.jpg" alt="Ad">
      </a>
      <div class="promo-body"></div>
      <div class="promo-actions">
        <a href="https://www.oasisinet.com/" target="_blank" rel="noopener" class="promo-btn learn">Learn more</a>
        <button id="promoCloseBtn" class="promo-btn close">Close &amp; Play</button>
      </div>
    </div>
  </div>

  <div id="howToPlayModal" aria-modal="true" role="dialog">
    <div id="howToPlayContent">
      <h2 style="text-align:center; margin:0 0 10px;">How to Play</h2>
      <p>🎯 You have 7 facedown cards numbered <strong>1 to 7</strong>.</p>
      <p>🔄 The back has numbers 1–7 in random order.</p>
      <p>🃏 Pick any card. That number = next card position.</p>
      <p>🏆 Reveal all 7 without repeats to win.</p>
      <p>❌ If you’re sent to an already-open card, you bust.</p>
      <div class="howto-actions"><button onclick="closeHowToPlay()">Got it!</button></div>
    </div>
  </div>

  <script>
    /* Confetti and Game Logic unchanged ... */
  </script>
</body>
</html>
