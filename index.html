<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>LUCKY 7</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#17173A" />

  <!-- iOS support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="icon-512.png">

  <style>
    :root { --bg:#17173A; --fg:#ffffff; --card:#ffffff; --accent:#ffffff; }

    /* Single-scroll layout */
    html, body {
      margin: 0; padding: 0; height: 100%;
      background: var(--bg); color: var(--fg);
      font-family: Arial, sans-serif;
      -webkit-text-size-adjust: none;
      touch-action: manipulation;
      overscroll-behavior: none;
      overflow: hidden;                /* <-- no page scrollbar */
    }
    body.modal-open { overflow: hidden; height: 100%; } /* lock bg while a modal is open */

    .app {
      height: 100dvh;                  /* fill the viewport height */
      display: flex; flex-direction: column;
      overflow: auto;                  /* <-- the only scrollbar, if needed */
      -webkit-overflow-scrolling: touch;
      padding:
        env(safe-area-inset-top)
        env(safe-area-inset-right)
        env(safe-area-inset-bottom)
        env(safe-area-inset-left);
    }
    .app-inner {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      padding: 20px; box-sizing: border-box; text-align: center;
    }

    .logo { width: clamp(160px, 30vw, 360px); height: auto; margin: 0 auto 18px; }
    .cards { display:flex; justify-content:center; flex-wrap:wrap; gap:12px; margin:20px 0; }
    .card-container { perspective: 1000px; }
    .card-inner { width:clamp(90px,12vw,120px); height:clamp(150px,21vw,200px); position:relative; transform-style:preserve-3d; transition:transform .6s; cursor:pointer; }
    .card.flipped .card-inner { transform: rotateY(180deg); cursor: default; }
    .card-face { position:absolute; inset:0; border-radius:12px; backface-visibility:hidden; display:flex; align-items:center; justify-content:center; font-size:clamp(28px,4vw,48px); font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,.3); }
    .card-front { background:royalblue; border:3px solid #fff; }
    .card-back  { background:var(--card); color:#000; border:3px solid #fff; transform:rotateY(180deg); position:relative; }
    .position-label { font-size:clamp(14px,2vw,18px); margin-top:6px; color:var(--fg); }

    .button-row { display:flex; justify-content:center; gap:16px; margin-top:15px; }
    #howToPlayButton { padding:8px 20px; min-width:120px; font-size:16px; font-weight:bold; border-radius:6px; background:var(--bg); color:var(--fg); border:2px solid var(--accent); cursor:pointer; }
    #howToPlayButton:hover{ background:#1e1e45; }

    .scoreboard{ display:flex; justify-content:center; gap:20px; margin-top:15px; }
    .scorebox{ background:var(--card); color:#000; padding:10px 20px; border-radius:8px; font-size:18px; font-weight:bold; min-width:100px; }

    /* Win overlay */
    .win-overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:10001; pointer-events:none; }
    .win-overlay .text{ font-size:clamp(72px,16vw,220px); font-weight:900; color:#FFD700;
      text-shadow:-4px -4px 0 #000,4px -4px 0 #000,-4px 4px 0 #000,4px 4px 0 #000,0 -5px 0 #000,0 5px 0 #000,-5px 0 0 #000,5px 0 0 #000;
      animation:winTextFlash .25s ease-in-out infinite alternate; }
    @keyframes winTextFlash{ 0%{transform:scale(1)} 100%{transform:scale(1.12)} }
    .win-overlay.show{ display:flex; }

    .copyright{ font-size:1em; margin-top:10px; opacity:.8; }

    /* Fullscreen toggle */
    .fs-toggle{ position:fixed; top:10px; right:10px; width:34px; height:34px; line-height:30px; text-align:center; font-size:20px; font-weight:900; color:#fff; background:rgba(0,0,0,.35); border:2px solid #fff; border-radius:8px; cursor:pointer; z-index:10002; backdrop-filter:blur(2px); }
    .fs-toggle:active{ transform:scale(.96); }

    /* ===================== MODALS ===================== */
    /* Promo / Ad modal overlay */
    #promoModal{
      display:none; position:fixed; z-index:10000; inset:0;
      background:rgba(0,0,0,.75); backdrop-filter:blur(2px);
      overflow:auto;                 /* scroll inside overlay if needed */
    }
    /* Promo card raised */
    #promoContent{
      background:#1D1D3F; color:#fff;
      margin:32px auto 0;
      padding:20px 22px; border-radius:12px;
      max-width:420px; width:calc(100% - 40px);
      text-align:left; box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    @media (max-height:640px){ #promoContent{ margin:16px auto 0; } }

    /* Centered How-to modal overlay */
    #howToPlayModal{
      display:none; position:fixed; z-index:10000; inset:0;
      background:rgba(0,0,0,.75); backdrop-filter:blur(2px);
      display:flex; align-items:center; justify-content:center;
      padding:16px;                 /* small gutter on tiny screens */
    }
    #howToPlayContent{
      background:#1D1D3F; color:#fff;
      padding:20px 22px; border-radius:12px;
      max-width:420px; width:calc(100% - 40px);
      text-align:left; box-shadow:0 10px 30px rgba(0,0,0,.35);
      margin:0; /* true centering */
      max-height:90vh; overflow:auto; /* keep it usable on very small screens */
    }
    .howto-actions{ text-align:center; margin-top:14px; }
    .howto-actions button{ padding:10px 24px; background:#fff; color:#000; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
  </style>
</head>

<body>
  <div class="app">
    <div class="app-inner">
      <img class="logo" src="logo.png?v=3" alt="Lucky 7"/>
      <div class="cards" id="cardContainer"></div>

      <div class="button-row">
        <button id="howToPlayButton" onclick="showHowToPlay()">How to Play</button>
      </div>

      <div class="scoreboard">
        <div class="scorebox">Won: <span id="winCount">0</span></div>
        <div class="scorebox">Lost: <span id="loseCount">0</span></div>
      </div>

      <div class="copyright">¬© Kev Shirreffs 2025</div>
    </div>
  </div>

  <!-- Fullscreen toggle -->
  <button id="fsToggle" class="fs-toggle" aria-label="Enter fullscreen" title="Enter fullscreen" hidden>‚õ∂</button>

  <!-- Win overlay -->
  <div id="winOverlay" class="win-overlay"><div class="text">YOU WIN!</div></div>

  <!-- Promo / Ad modal -->
  <div id="promoModal" aria-modal="true" role="dialog">
    <div id="promoContent">     
      <a href="https://www.oasisinet.com/" target="_blank" rel="noopener">
        <img src="oasis.jpg" alt="Ad" style="display:block; width:100%; height:auto; border-radius:8px; margin-bottom:12px;">
      </a>
      <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
        <a href="https://www.oasisinet.com/" target="_blank" rel="noopener" style="flex:1; text-align:center; padding:6px 12px; font-size:14px; font-weight:700; background:#FFD700; color:#000; text-decoration:none; border-radius:6px;">Learn more</a>
        <button id="promoCloseBtn" style="flex:1; text-align:center; padding:6px 12px; font-size:14px; font-weight:700; background:#fff; color:#000; border:none; border-radius:6px;">Close &amp; Play</button>
      </div>
    </div>
  </div>

  <!-- How to Play modal (hidden on load; opens only via button) -->
  <div id="howToPlayModal" aria-modal="true" role="dialog">
    <div id="howToPlayContent">
      <h2 style="text-align:center; margin:0 0 10px;">How to Play</h2>
      <p>üéØ You have 7 facedown cards numbered <strong>1 to 7</strong> on the front.</p>
      <p>üîÑ The back of each card has a number (also <strong>1 to 7</strong>) in a random order.</p>
      <p>üÉè Start by picking any card.</p>
      <p>üìç The number you reveal tells you which <strong>position</strong> you must flip next.</p>
      <p>üèÜ Reveal <strong>all 7 cards</strong> without repeating a position to win.</p>
      <p>‚ùå If a number points to a card that‚Äôs already face-up, you <strong>bust</strong> and lose.</p>
      <div class="howto-actions"><button onclick="closeHowToPlay()">Got it!</button></div>
    </div>
  </div>

  <!-- Your game logic -->
  <script src="app.js"></script>

  <!-- Minimal helpers -->
  <script>
    // Promo modal: show ONCE per session at load; only Close button dismisses.
    function showPromo(){
      const m=document.getElementById('promoModal');
      if(!m) return;
      m.style.display='block';
      document.body.classList.add('modal-open');
    }
    function closePromo(){
      const m=document.getElementById('promoModal');
      if(!m) return;
      m.style.display='none';
      document.body.classList.remove('modal-open');
      sessionStorage.setItem('promoDismissed','1');
    }
    document.addEventListener('click',e=>{
      if(e.target && e.target.id==='promoCloseBtn') closePromo();
    });
    window.addEventListener('DOMContentLoaded', ()=>{
      if(!sessionStorage.getItem('promoDismissed')) showPromo();
    });

    // How-to modal: HIDDEN on load; opens ONLY when button is pressed
    (function(){
      const howto = document.getElementById('howToPlayModal');
      if (howto) howto.style.display = 'none';  // ensure hidden on first paint
    })();
    function showHowToPlay(){
      const m=document.getElementById('howToPlayModal');
      if(m) m.style.display='flex';     // centered (flex)
      document.body.classList.add('modal-open');
    }
    function closeHowToPlay(){
      const m=document.getElementById('howToPlayModal');
      if(m) m.style.display='none';
      document.body.classList.remove('modal-open');
    }
    window.showHowToPlay = showHowToPlay;
    window.closeHowToPlay = closeHowToPlay;

    // Fullscreen toggle (unchanged)
    (function(){
      const btn=document.getElementById('fsToggle'); const root=document.documentElement;
      if(!document.fullscreenEnabled) return; btn.hidden=false;
      function update(){ const a=!!document.fullscreenElement; btn.title=a?'Exit fullscreen':'Enter fullscreen'; btn.setAttribute('aria-label',btn.title); btn.innerText=a?'√ó':'‚õ∂'; }
      async function toggle(){ try{ if(!document.fullscreenElement) await root.requestFullscreen(); else await document.exitFullscreen(); }catch(e){console.error(e);}finally{update();} }
      btn.addEventListener('click',toggle); document.addEventListener('fullscreenchange',update); update();
    })();
  </script>
</body>
</html>
